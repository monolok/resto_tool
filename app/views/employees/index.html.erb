<p id="notice"><%= notice %></p>

<div class="container-fluid">
  <div class="row">
    <div class="col-xs-8">
      <h2>Employees</h2>

      <%= link_to "All employees", employees_path%>

      <%if user_signed_in?%>
          <%= link_to Category.find(1).name, employees_path(pom: 1)%>
      <%else%>
        <% if current_reviewer.vl == 0%>
          <%= link_to Category.find(1).name, employees_path(pom: 1)%>
        <%else%>
          <p>no</p>
        <%end%>
      <%end%>

      <%if user_signed_in?%>
          <%= link_to Category.find(2).name, employees_path(pom: 2)%>
      <%else%>
        <% if current_reviewer.l == 0%>
          <%= link_to Category.find(2).name, employees_path(pom: 2)%>
        <%else%>
          <p>no</p>
        <%end%>
      <%end%>

      <%if user_signed_in?%>
          <%= link_to Category.find(3).name, employees_path(pom: 3)%>
      <%else%>
        <% if current_reviewer.m == 0%>
          <%= link_to Category.find(3).name, employees_path(pom: 3)%>
        <%else%>
          <p>no</p>
        <%end%>
      <%end%>

      <%if user_signed_in?%>
          <%= link_to Category.find(4).name, employees_path(pom: 4)%>
      <%else%>
        <% if current_reviewer.h == 0%>
          <%= link_to Category.find(4).name, employees_path(pom: 4)%>
        <%else%>
          <p>no</p>
        <%end%>
      <%end%>

      <%if user_signed_in?%>
          <%= link_to Category.find(5).name, employees_path(pom: 5)%>
      <%else%>
        <% if current_reviewer.vh == 0%>
          <%= link_to Category.find(5).name, employees_path(pom: 5)%>
        <%else%>
          <p>no</p>
        <%end%>
      <%end%>

      <div class="row">
        <% @employees.each do |employee| %>

          <%@list_s = Array.new%>
          <%if not employee.scores.blank?%>
            <%employee.scores.each do |s|%>
              <%@list_s.push(s.average)%>
              <%@kf_sum = @list_s.inject(:+)%>
              <%@kf = @kf_sum/employee.scores.count%>
            <%end%>
          <%else%>
            <%@kf = 0%>
          <%end%> 

          <div class="col-sm-4 border-employee">
            <div class="row">
              <%= link_to employee.name, employee%>
            </div>
            <div class="row">
              <%if @kf > 2.5 %>
                <p class="bg-success">KEEP</p>
              <%elsif @kf == 0 %>
                <p>No review</p>
              <%else%>
                <p class="bg-danger">FIRE</p>
              <%end%>
            </div>
            <div class="row">
              <%= employee.position%>
            </div>

            <div class="row">
            <% if employee.scores.last.nil?%>
            <%else%>
            <%@last_time_reviewer_id = employee.scores.last.reviewer_id%>      
            <%end%>

              <% if @last_time_reviewer_id.nil?%>
                <p>Last review by: Admin</p>
              <%else%>
              <% @reviewer = Reviewer.find(@last_time_reviewer_id)%>
                <p>Last review by: <%= @reviewer.name%></p>
              <%end%>
            </div> 
          <% if user_signed_in?%>
            <div class="row">
              <%= link_to 'Destroy', employee, method: :delete, data: { confirm: 'Are you sure?' } %>        
            </div>
          <%end%>

            <div class="row">
              <%= link_to "Review #{employee.name}", employee_score_new_path(employee.id)%>        
            </div>                   
          </div>

        <% end %>    
      </div>
    </div>

    <div class="col-xs-4">
      <h2>Reviewers: </h2>
      <p><%= alert %></p>  
      </br>  
      </br>        
      <ul class="ul_style border-reviewer">
        <%if current_user.reviewers.blank? %>
          <li>No reviewers ! <%= link_to "Add one", new_reviewer_registration_path %></li>
        <%else%>
          <% current_user.reviewers.each do |r| %>
            <li><%= r.name%></li>
            <li>Last sign in: <%= r.updated_at%></li>
            <%if r.scores.empty?%>
              <li>No scores</li>
            <%else%>
              <li>Last employee reviewed is: <%= link_to r.scores.last.employee.name, employee_path(r.scores.last.employee.id) %></li>
            <%end%>
            <li><%= link_to "Delete reviewer", "reviewer_delete/#{r.id}", :method => :delete %></li>
          <%end%>
        <%end%>
      </ul>
    </div>
  </div>
</div>